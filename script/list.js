let viewModel = {
    records: ko.observableArray([
        {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        }, {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('James Henderson'),
            email: ko.observable('jimmyhenderson@gmail.com'),
            phone: ko.observable('+1 098 275 3514'),
            country: ko.observable('United States'),
            state: ko.observable('Montana'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Jacob Smith'),
            email: ko.observable('mrsmith155@gmail.com'),
            phone: ko.observable('+1 287 275 3228'),
            country: ko.observable('United States'),
            state: ko.observable('Tennessee'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('Abraham Davis'),
            email: ko.observable('davisaraham@email.com'),
            phone: ko.observable('+44 202 555 3894'),
            country: ko.observable('United Kingdom'),
            state: ko.observable('Wales'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('John Kirby'),
            email: ko.observable('1968kirby@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Lviv'),
            gender: ko.observable('Male'),
        },
        {
            name: ko.observable('denys'),
            email: ko.observable('1email@gmail.com'),
            phone: ko.observable('+38 202 908 2132'),
            country: ko.observable('Ukraine'),
            state: ko.observable('Ternopil'),
            gender: ko.observable('Male'),
        },
    ]),
    visibleRecords: ko.observableArray([
    ]),
    pageLength: ko.observable(5),
    currentPage: ko.observable(1),
    decrease: function () {
        if ($('.filter-option').val() != 'none') {
            let pageLength = parseInt(viewModel.pageLength())
            let allRecordsLength = parseInt(records.length)
            let max = Math.ceil(allRecordsLength / pageLength)
            let currentPage = viewModel.currentPage()
            currentPage--;
            viewModel.currentPage(
                (currentPage < 1) ? max : currentPage
            )
            currentPage = viewModel.currentPage()
            viewModel.visibleRecords(
                records.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )

            $('.input-page').val(viewModel.currentPage())
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        } else {
            let pageLength = parseInt(viewModel.pageLength())
            let allRecordsLength = parseInt(viewModel.records().length)
            let max = Math.ceil(allRecordsLength / pageLength)
            let currentPage = viewModel.currentPage()
            currentPage--;
            viewModel.currentPage(
                (currentPage < 1) ? max : currentPage
            )
            currentPage = viewModel.currentPage()

            let allRecords = viewModel.records()
            viewModel.visibleRecords(
                allRecords.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )

            $('.input-page').val(viewModel.currentPage())
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        }


    },
    increase: function () {
        if ($('.filter-option').val() != 'none') {
            let pageLength = parseInt(viewModel.pageLength())
            let allRecordsLength = parseInt(records.length)
            let max = Math.ceil(allRecordsLength / pageLength) + 1
            let currentPage = viewModel.currentPage()
            currentPage++;
            viewModel.currentPage(
                (currentPage >= max) ? 1 : currentPage
            )
            currentPage = viewModel.currentPage()
            viewModel.visibleRecords(
                records.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )
            $('.input-page').val(viewModel.currentPage())
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        } else {
            let pageLength = parseInt(viewModel.pageLength())
            let allRecordsLength = parseInt(viewModel.records().length)
            let max = Math.ceil(allRecordsLength / pageLength) + 1
            let currentPage = viewModel.currentPage()
            currentPage++;
            viewModel.currentPage(
                (currentPage >= max) ? 1 : currentPage
            )
            currentPage = viewModel.currentPage()
            console.log(currentPage);

            let allRecords = viewModel.records()
            viewModel.visibleRecords(
                allRecords.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )
            $('.input-page').val(viewModel.currentPage())
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        }

    },
    changePageLength: function (context, e) {
        if ($('.filter-option').val() != 'none') {
            let select = e.target;

            viewModel.pageLength(
                parseInt(select.value)
            )

            let pageLength = parseInt(viewModel.pageLength())
            let currentPage = 1

            viewModel.visibleRecords(
                records.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )
            allRecordsLength = parseInt(records.length)
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))

        } else {
            let select = e.target;

            viewModel.pageLength(
                parseInt(select.value)
            )

            let pageLength = parseInt(viewModel.pageLength())
            let currentPage = 1

            let allRecords = viewModel.records()
            viewModel.visibleRecords(
                allRecords.slice((currentPage - 1) * pageLength, currentPage * pageLength)
            )

            allRecordsLength = parseInt(viewModel.records().length)
            $('.page-val').text(Math.ceil(allRecordsLength / pageLength))

        }

    },
    filter: function (context, e) {
        let select = e.target;
        let option = select.id;

        let pageLength = parseInt(viewModel.pageLength())
        let currentPage = 1

        let allRecords = viewModel.records()
        records = _.filter(allRecords, function (num) {
            if (option == 'id') {
                return num.id == select.value;
            }
            else if (option == 'name') {
                return num.name().toLowerCase().includes(select.value.toLowerCase());
            }

            else if (option == 'country') {
                return num.country().toLowerCase().includes(select.value.toLowerCase());
            }

            else if (option == 'state') {
                return num.state().toLowerCase().includes(select.value.toLowerCase());
            }

            else if (option == 'gender') {
                return num.gender().toLowerCase().includes(select.value.toLowerCase());
            }
        });
        viewModel.visibleRecords(
            records.slice((currentPage - 1) * pageLength, currentPage * pageLength)
        )

        let allRecordsLength = parseInt(records.length)
        $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        $('.input-page').val(1)
    },
    filterNone: function (context, e) {

        let allRecordsLength = parseInt(viewModel.records().length)
        let pageLength = parseInt(viewModel.pageLength())
        let currentPage = 1

        records = viewModel.records()
        let allRecords = viewModel.records()
        viewModel.visibleRecords(
            allRecords.slice((currentPage - 1) * pageLength, currentPage * pageLength)
        )
        $('.input-page').val(viewModel.currentPage())
        $('.page-val').text(Math.ceil(allRecordsLength / pageLength))
        $('.no-results').css("display", "none")
    }
};

_.each(viewModel.records(), function (val, i) {
    val.id = i + 1
})

let records = viewModel.records()


ko.applyBindings(viewModel);

viewModel.pageLength(
    parseInt(5)
)

let allRecordsLength = parseInt(viewModel.records().length)
let pageLength = parseInt(viewModel.pageLength())
let currentPage = 1

let allRecords = viewModel.records()
viewModel.visibleRecords(
    allRecords.slice((currentPage - 1) * pageLength, currentPage * pageLength)
)

$('.input-page').val(viewModel.currentPage())


$('.page-val').text(Math.ceil(allRecordsLength / pageLength))